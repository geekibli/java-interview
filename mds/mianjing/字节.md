# 字节番茄小说

一面  约1h
1. 自我介绍
2. 项目相关
(团队人数 | 项目应用到的框架等 | 表设计)
3. Java中常用的集合类
(先说Collection和Map接口，再分别说子接口和实现类，以及大概的区别，没让细讲源码)

```
Java中哪些集合是有序的？ https://blog.csdn.net/dl674756321/article/details/103412697    
```

4. 有一组数据，需要按照顺序对它进行加密，如果用集合做的话你会选哪个集合？比如一个数组，其元素本身无序，每个元素是字母或者数字都行，对它从小到大进行排序，你会选哪个集合去存储？
(我当时好像选的TreeMap？忘记了...)  

```
有排序顺序的集合：   
treeSet ： 底层是treeMap
treeMap :  底层是红黑树
PriorityQueue  ： 二叉堆
ConcurrentSkipListMap  跳表

```

这些都是有排序特性的  

**30张图带你彻底理解红黑树  https://www.jianshu.com/p/e136ec79235c**   

**什么是线程安全？**   

```java
“当多个线程同时访问一个对象时，如果不用考虑这些线程在运行时环境下的调度和交替执行，也不需要进行额外的同步，或者在调用方进行任何其他的协调操作，调用这个对象的行为都可以获得正确的结果，那就称这个对象是线程安全的”

摘录来自: 周志明. “深入理解Java虚拟机：JVM高级特性与最佳实践（第3版） (华章原创精品)。” Apple Books. 
```


5. Java中线程同步的方案有哪些
(参考《深入理解Java虚拟机》第13章第2节，从“阻塞同步方案 | 非阻塞同步方案 | 无同步方案”三部分说明)

```
1. 阻塞同步方案
    不可变类型 Immutable
    final 枚举

    “互斥同步面临的主要问题是进行线程阻塞和唤醒所带来的性能开销，因此这种同步也被称为阻塞同步（Blocking Synchronization）。从解决问题的方式上看，互斥同步属于一种**悲观**的并发策略”

    synchronized + Locks

2. 非阻塞同步方案

“基于冲突检测的乐观并发策略，通俗地说就是不管风险，先进行操作，如果没有其他线程争用共享数据，那操作就直接成功了；如果共享的数据的确被争用，产生了冲突，那再进行其他的补偿措施，最常用的补偿措施是不断地重试，直到出现没有竞争的共享数据为止”

“这种乐观并发策略的实现不再需要把线程阻塞挂起”

3.无同步方案 

    代码可重入
    线程本地变量

```


6. Lock接口的实现类
(参考《Java并发编程的艺术》第5章，Lock接口的实现基本都是通过聚合了一个同步器的子类来完成线程访问控制的，引出了队列同步器AQS，实现类讲了ReentrantLock和ReentrantReadWriteLock)


7. MySQL查询比较慢的话，通过什么方式来优化
(情况①：偶尔很慢，可能是数据库在查询脏页，或者没拿到锁
情况②：一直很慢，可能是没有索引，或者有索引但没走索引，或者表数据量太大需要分库分表)

8. http协议
(http是哪一层的协议，其传输层协议是什么，三次握手和四次挥手的完整过程)

    https://mp.weixin.qq.com/s/rX3A_FA19n4pI9HicIEsXg

9. 算法题：lc726 原子的数量
(稍微变型，不必统计所有原子的数量，统计输入的目标原子的数量)

10. 反问部门和技术栈
其实是面试体验不太好的，不是面试官的面试过程有问题，是他没关消息提示，整个面试过程听了可能上百声“叮咚”的消息提示音，一开始没适应的时候会打断思路。最后的算法做的不咋地，给了大概20min，说了思路没全写完，面试官说思路应该可以，他还有下一场面试。

二面 约80min
1. 自我介绍
2. 项目相关
3. Java中有个String类，如果我们自己写一个java.lang.String类，会出现问题吗
(参考《深入理解Java虚拟机》第7章 虚拟机类加载机制，主要讲了类加载器的种类和双亲委派模型)  

4. Java里的Map有哪几种实现
(HashMap | TreeMap | HashTable | LinkedHashMap | ConcurrentHashMap)

    LinkedHashMap 源码详细分析（JDK1.8） https://segmentfault.com/a/1190000012964859

5. TreeMap的使用场景，底层数据结构，红黑树的存取复杂度

```
TreeMap实现了NavigableMap接口，而NavigableMap接口继承着SortedMap接口，致使我们的TreeMap是有序的！
TreeMap底层是红黑树，它方法的时间复杂度都不会太高:log(n)~
非同步
使用Comparator或者Comparable来比较key是否相等与排序的问题~

https://segmentfault.com/a/1190000014345983
```


6. LinkedHashMap的使用场景
(用LinkedHashMap实现lru，按插入顺序(默认) accessOrder = false | 按访问顺序 accessOrder = true，HashMap+双向链表)


7. Java中有个volatile关键字用过吗，用volatile修饰的变量来记录访问次数，需要其他同步操作吗
(场景：单例模式等，参考《深入理解Java虚拟机》第12章12.3.3“对于volatile型变量的特殊规则”，从Java内存模型JMM的角度讲volatile，说明指令中的lock前缀和将esp寄存器的值+0这个空操作)

8. Java有哪些同步方案，如果不加锁呢，加锁会不会太重了
(参考《深入理解Java虚拟机》第13章第2节，从“阻塞同步方案 | 非阻塞同步方案 | 无同步方案”三部分说明，面试官提到加锁会不会太重的时候，我提了一下synchronized锁升级)

```
不加锁 可以参考乐观方案 CAS ThreadLocal等
```

9. CAS的ABA问题是什么，要怎么解决
(参考《深入理解Java虚拟机》P477)

```
“J.U.C包为了解决这个问题，提供了一个带有标记的原子引用类AtomicStampedReference，它可以通过控制变量值的版本来保证CAS的正确性。不过目前来说这个类处于相当鸡肋的位置，大部分情况下ABA问题不会影响程序并发的正确性，如果需要解决ABA问题，改用传统的互斥同步可能会比原子类更为高效。”

摘录来自: 周志明. “深入理解Java虚拟机：JVM高级特性与最佳实践（第3版） (华章原创精品)。” Apple Books. 
```
10. 有没有用过工具，怎么查看Java堆的统计信息
(参考《深入理解Java虚拟机》第4章，没用过工具，只说了常用了JVM参数)

`jmap -heap pid`       


11. 我们来问问网络吧，DNS是哪层的协议   应用层  


12. tcp有个状态是Time_Wait，这个具体是在哪儿，作用是什么

     https://mp.weixin.qq.com/s/rX3A_FA19n4pI9HicIEsXg

13. get和post的区别，用get和post传输的时候有个编码，那个编码的作用是什么
(一开始没听懂问题，说的是Accept-Encoding，后来面试官说是想问http请求中特殊字符的转义)

```
https://blog.csdn.net/weixin_34416649/article/details/92483446

有些符号在URL中是不能直接传递的，如果要在URL中传递这些特殊符号，那么就要使用他们的编码了
编码的格式为：%加字符的ASCII码，
即一个百分号%，后面跟对应字符的ASCII（16进制）码值
```

14. 有没有面过别的公司 | 哪儿的人
15. 给了个C++的结构体，有char、int等3个属性，问占多少内存，换了个顺序，又问占多少内存
(这个不大会，有会的老哥欢迎评论)

算法题：

1.  [算法1]：求最大长度的自然序子数组，输出长度和子数组下标(从1开始)，不要求连续，自然序是指“123456...”，即3的后面必须是4，以此类推
如，3344567，输出应为4，[2,3,4,5]，即数组的第2/3/5/6个元素“3456”

2. [算法2]：二叉树的层序遍历(面试官：再写个常规的吧)

3.  做完题开始问数据库相关的，聚集索引和非聚集索引
4.  事务隔离级别
5.  怎么实现的可重复读
(主要从锁机制+MVCC的角度讲，详细说明了当前要访问的版本的事务id和ReadView中活跃事务id列表的关系，如果大于最大值怎么样，小于最小值怎么样，介于最大值最小值之间要怎么办)

